name: Auto Commit and Push

on:
  push:
    branches:
      - main
  workflow_dispatch:  # å…è¨±æ‰‹å‹•è§¸ç™¼
  schedule:
    - cron: '*/5 * * * *'  # æ¯5åˆ†é˜æª¢æŸ¥ä¸€æ¬¡

jobs:
  auto-commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: æª¢å‡ºç¨‹å¼ç¢¼
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: è¨­å®š Git ä½¿ç”¨è€…è³‡è¨Š
        run: |
          git config --global user.name 'GitHub Actions Bot'
          git config --global user.email 'actions@github.com'
          
      - name: æª¢æŸ¥è®Šæ›´ä¸¦æäº¤
        run: |
          echo "ğŸ” æª¢æŸ¥æª”æ¡ˆè®Šæ›´..."
          git add .
          
          if git diff --cached --quiet; then
            echo "âœ… æ²’æœ‰è®Šæ›´ï¼Œè·³éæäº¤ã€‚"
          else
            echo "ğŸ“ ç™¼ç¾è®Šæ›´ï¼Œæº–å‚™æäº¤..."
            
            # ç”Ÿæˆæ™ºèƒ½ commit è¨Šæ¯
            TIMESTAMP=$(date +'%Y-%m-%d %H:%M:%S')
            CHANGED_FILES=$(git diff --cached --name-only | tr '\n' ' ')
            
            COMMIT_MSG="Auto commit: $TIMESTAMP

è®Šæ›´æª”æ¡ˆ:
$(git diff --cached --name-only | sed 's/^/- /')

é€é GitHub Actions è‡ªå‹•æäº¤"
            
            git commit -m "$COMMIT_MSG"
            echo "âœ… æäº¤æˆåŠŸ: $TIMESTAMP"
            
            # æ¨é€åˆ°é ç«¯
            git push origin main
            echo "ğŸš€ æ¨é€æˆåŠŸ"
          fi
          
      - name: é¡¯ç¤ºæäº¤æ­·å²
        run: |
          echo "ğŸ“Š æœ€è¿‘ 3 æ¬¡æäº¤:"
          git log --oneline -3
